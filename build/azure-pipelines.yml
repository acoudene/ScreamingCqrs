trigger:
  branches:
    include:
      - main
      - develop

pr:
  branches:
    include:
      - main
      - develop

variables:
  buildConfiguration: 'Release'
  outputPath: '$(Build.ArtifactStagingDirectory)/artifacts'

stages:
  - stage: Build
    displayName: 'Build & Test'
    jobs:
      - job: Build
        displayName: 'Build Solution'
        pool:
          vmImage: 'windows-latest'
        steps:
          - task: UseDotNet@2
            displayName: 'Install .NET SDK'
            inputs:
              packageType: 'sdk'
              version: '8.0.x'

          - script: dotnet restore ./Company.Feature.sln
            displayName: 'Restore NuGet Packages'

          - script: dotnet build ./Company.Feature.sln --configuration $(buildConfiguration) --no-restore
            displayName: 'Build Solution'

          - script: dotnet test ./Company.Feature.sln --configuration $(buildConfiguration) --no-build --verbosity normal
            displayName: 'Run Tests'

          - script: dotnet pack ./Company.Feature.sln --configuration $(buildConfiguration) --no-build --output $(outputPath)
            displayName: 'Pack NuGet packages'

          - task: PublishBuildArtifacts@1
            displayName: 'Publish Artifacts'
            inputs:
              pathToPublish: '$(outputPath)'
              artifactName: 'packages'
